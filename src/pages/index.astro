---
import { type CollectionEntry, getCollection } from "astro:content";
import SocialList from "@/components/SocialList.astro";
import PostPreview from "@/components/blog/PostPreview.astro";
import Note from "@/components/note/Note.astro";
import { getAllPosts } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import { collectionDateSort } from "@/utils/date";

// Posts
const MAX_POSTS = 10;
const allPosts = await getAllPosts();
const allPostsByDate = allPosts
  .sort(collectionDateSort)
  .slice(0, MAX_POSTS) as CollectionEntry<"post">[];

// Pinned Posts, set to a max of 3;
const MAX_PINNED_POSTS = 3;
const pinnedPosts = allPostsByDate
  .filter((p) => p.data.pinned)
  .slice(0, MAX_PINNED_POSTS);

// Notes
const MAX_NOTES = 5;
const allNotes = await getCollection("note");
const latestNotes = allNotes.sort(collectionDateSort).slice(0, MAX_NOTES);
---

<PageLayout meta={{ title: "Home" }}>
  <section>
    <h1 class="title mb-12">Hey there! ðŸ‘‹</h1>
    <p class="mb-4">
      I'm Yuri, a Senior Software Engineer who loves diving deep into full-stack
      development. I spend most of my time crafting web applications, optimizing
      performance, and exploring new technologies that make developers' lives
      easier.
    </p>
    <p class="mb-6">
      When I'm not coding, you'll find me sharing my thoughts on remote work,
      system architecture, and the occasional debugging adventure. Feel free to
      reach out if you want to chat about anything tech-related or just say
      hello!
    </p>
    <SocialList />
  </section>
  {
    pinnedPosts.length > 0 && (
      <section class="mt-16">
        <h2 class="title mb-6 text-xl">Pinned Posts</h2>
        <ul class="space-y-4" role="list">
          {pinnedPosts.map((p) => (
            <li class="grid gap-1 sm:grid-cols-[auto_1fr]">
              <PostPreview post={p} />
            </li>
          ))}
        </ul>
      </section>
    )
  }
  <section class="mt-16">
    <h2 class="title text-accent mb-6 text-xl"><a href="/posts/">Posts</a></h2>
    <ul class="space-y-4" role="list">
      {
        allPostsByDate.map((p) => (
          <li class="grid gap-1 sm:grid-cols-[auto_1fr]">
            <PostPreview post={p} />
          </li>
        ))
      }
    </ul>
  </section>
  {
    latestNotes.length > 0 && (
      <section class="mt-16">
        <h2 class="title text-accent mb-6 text-xl">
          <a href="/notes/">Notes</a>
        </h2>
        <ul class="space-y-6" role="list">
          {latestNotes.map((note) => (
            <li>
              <Note note={note} as="h3" isPreview />
            </li>
          ))}
        </ul>
      </section>
    )
  }
</PageLayout>
